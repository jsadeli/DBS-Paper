(function(a){a.fn.poptrox_disableSelection=function(){return a(this).css("user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-o-user-select","none").css("-webkit-user-select","none")};a.fn.poptrox=function(g){var C=a.extend({preload:false,baseZIndex:1000,fadeSpeed:300,overlayColor:"#000000",overlayOpacity:0.6,windowMargin:50,windowHeightPad:0,selector:"a",popupSpeed:300,popupWidth:200,popupHeight:100,popupIsFixed:false,useBodyOverflow:true,usePopupEasyClose:true,usePopupLoader:true,usePopupCloser:true,usePopupCaption:false,usePopupNav:false,usePopupDefaultStyling:true,popupBackgroundColor:"#FFFFFF",popupTextColor:"#000000",popupLoaderTextSize:"2em",popupCloserBackgroundColor:"#000000",popupCloserTextColor:"#FFFFFF",popupCloserTextSize:"20px",popupPadding:10,popupCaptionHeight:60,popupCaptionTextSize:null,popupBlankCaptionText:"(untitled)",popupCloserText:"&#215;",popupLoaderText:"&bull;&bull;&bull;&bull;",popupClass:"poptrox-popup",popupSelector:null,popupLoaderSelector:".loader",popupCloserSelector:".closer",popupCaptionSelector:".caption",popupNavPreviousSelector:".nav-previous",popupNavNextSelector:".nav-next",onPopupClose:null,onPopupOpen:null},g);var t=navigator.userAgent.match(/MSIE ([0-9]+)\./),u=t&&(RegExp.$1==6),D=t&&(RegExp.$1<8);var c=(u?"absolute":"fixed");var k=!!("ontouchstart" in window),B="click";var l=false,q=new Array();var w=a(this);var d=a("body");var i=a("<div></div>");var y=a(window);var E,m,v=[],p=0;function o(){E=a(window).width();m=a(window).height()+C.windowHeightPad}if(!C.usePopupLoader){C.popupLoaderSelector=null}if(!C.usePopupCloser){C.popupCloserSelector=null}if(!C.usePopupCaption){C.popupCaptionSelector=null}if(!C.usePopupNav){C.popupNavPreviousSelector=null;C.popupNavNextSelector=null}if(C.popupSelector){var s=a(C.popupSelector)}else{var s=a('<div class="'+C.popupClass+'">'+(C.popupLoaderSelector?'<div class="loader">'+C.popupLoaderText+"</div>":"")+'<div class="pic"></div>'+(C.popupCaptionSelector?'<div class="caption"></div>':"")+(C.popupCloserSelector?'<span class="closer">'+C.popupCloserText+"</span>":"")+(C.popupNavPreviousSelector?'<div class="nav-previous"></div>':"")+(C.popupNavNextSelector?'<div class="nav-next"></div>':"")+"</div>")}var x=s.find(".pic");var z=a();var A=s.find(C.popupLoaderSelector);var j=s.find(C.popupCaptionSelector);var h=s.find(C.popupCloserSelector);var r=s.find(C.popupNavNextSelector);var b=s.find(C.popupNavPreviousSelector);var n=r.add(b);if(C.usePopupDefaultStyling){s.css("background",C.popupBackgroundColor);s.css("color",C.popupTextColor);s.css("padding",C.popupPadding+"px");if(j.length>0){s.css("padding-bottom",C.popupCaptionHeight+"px");j.css("position","absolute").css("left","0").css("bottom","0").css("width","100%").css("text-align","center").css("height",C.popupCaptionHeight+"px").css("line-height",C.popupCaptionHeight+"px");if(C.popupCaptionTextSize){j.css("font-size",popupCaptionTextSize)}}if(h.length>0){h.html(C.popupCloserText).css("font-size",C.popupCloserTextSize).css("background",C.popupCloserBackgroundColor).css("color",C.popupCloserTextColor).css("display","block").css("width","40px").css("height","40px").css("line-height","40px").css("text-align","center").css("position","absolute").css("text-decoration","none").css("outline","0").css("top","0").css("right","-40px")}if(A.length>0){A.html("").css("position","relative").css("font-size",C.popupLoaderTextSize).bind("startSpinning",function(G){var F=a("<div>"+C.popupLoaderText+"</div>");F.css("height",Math.floor(C.popupHeight/2)+"px").css("overflow","hidden").css("line-height",Math.floor(C.popupHeight/2)+"px").css("text-align","center").css("margin-top",Math.floor((s.height()-F.height()+(j.length>0?j.height():0))/2)).css("color",(C.popupTextColor?C.popupTextColor:"")).bind("xfin",function(){F.fadeTo(300,0.5,function(){F.trigger("xfout")})}).bind("xfout",function(){F.fadeTo(300,0.05,function(){F.trigger("xfin")})}).trigger("xfin");A.append(F)}).bind("stopSpinning",function(G){var F=A.find("div");F.remove()})}if(n.length==2){n.css("font-size","75px").css("text-align","center").css("color","#fff").css("text-shadow","none").css("height","100%").css("position","absolute").css("top","0").css("opacity","0.35").css("cursor","pointer").css("box-shadow","inset 0px 0px 10px 0px rgba(0,0,0,0)").poptrox_disableSelection();var f,e;if(C.usePopupEasyClose){f="100px";e="100px"}else{f="75%";e="25%"}r.css("right","0").css("width",f).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; right: 0; margin-top: -50px;">&gt;</div>');b.css("left","0").css("width",e).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; left: 0; margin-top: -50px;">&lt;</div>')}}y.bind("orientationchange",function(){y.trigger("resize")}).resize(function(){o();s.trigger("poptrox_close")});j.bind("update",function(G,F){if(!F||F.length==0){F=C.popupBlankCaptionText}j.html(F)});h.css("cursor","pointer").bind(B,function(F){F.preventDefault();F.stopPropagation();s.trigger("poptrox_close");return true});r.click(function(){s.trigger("poptrox_next")});b.click(function(){s.trigger("poptrox_previous")});i.prependTo(D?"body":"html").hide();if(u){i.css("position","absolute")}else{i.css("position",c).css("left",0).css("top",0).css("z-index",C.baseZIndex).css("width","200%").css("height","200%").css("background-color",C.overlayColor)}i.css("cursor","pointer").bind(B,function(F){F.preventDefault();F.stopPropagation();s.trigger("poptrox_close")});if(C.usePopupEasyClose){x.css("cursor","pointer").bind(B,function(F){F.preventDefault();F.stopPropagation();s.trigger("poptrox_close")})}s.bind("poptrox_next",function(){var F=p+1;if(F>=v.length){F=0}s.trigger("poptrox_switch",[F])}).bind("poptrox_previous",function(){var F=p-1;if(F<0){F=v.length-1}s.trigger("poptrox_switch",[F])}).bind("poptrox_reset",function(){o();s.css("position",c).css("z-index",C.baseZIndex+1).css("width",C.popupWidth+"px").css("height",C.popupHeight+"px").css("left",(E/2)+"px").css("top",(m/2)+"px").css("top",(m/2)+"px").css("margin-left",(-1*(s.outerWidth()/2))+"px").css("margin-top",(-1*(s.outerHeight()/2))+"px");A.hide().trigger("stopSpinning");j.hide();h.hide();n.hide();x.hide();z.detach()}).bind("poptrox_open",function(G,F){if(l){return true}l=true;if(C.useBodyOverflow){d.css("overflow","hidden")}if(C.onPopupOpen){(C.onPopupOpen)()}i.fadeTo(C.fadeSpeed,C.overlayOpacity,function(){s.trigger("poptrox_switch",[F,true])})}).bind("poptrox_switch",function(J,I,H){var F,G;if(!H&&l){return true}l=true;j.hide();if(z.attr("src")){z.attr("src","")}z.detach();F=v[I];z=F.object;z.unbind("load");x.css("text-indent","-9999em").show().append(z);if(F.type=="ajax"){a.get(F.src,function(K){z.html(K);z.trigger("load")})}else{z.attr("src",F.src)}if(F.type!="image"){z.css("position","relative").css("outline","0").css("z-index",C.baseZIndex+100).width(F.width).height(F.height)}A.trigger("startSpinning").fadeIn(300);s.show();if(C.popupIsFixed){s.width(C.popupWidth).height(C.popupHeight).css("margin-left",(-1*(s.innerWidth()/2))+"px").css("margin-top",(-1*(s.innerHeight()/2))+"px");z.load(function(){z.unbind("load");A.hide().trigger("stopSpinning");j.trigger("update",[F.captionText]).fadeIn(C.fadeSpeed);h.fadeIn(C.fadeSpeed);x.css("text-indent",0).hide().fadeIn(C.fadeSpeed,function(){l=false});p=I;n.fadeIn(C.fadeSpeed)})}else{z.load(function(){z.unbind("load");o();var K=Math.abs(s.width()-s.outerWidth()),Q=Math.abs(s.height()-s.outerHeight());var P=z.width(),L=z.height();var R=E-(C.windowMargin*2)-K,O=m-(C.windowMargin*2)-Q;A.hide().trigger("stopSpinning");if(P>R||L>O){var N,S,M;N=R/P;S=O/L;M=Math.min(N,S);P=Math.floor(M*P);L=Math.floor(M*L);z.width(P).height(L)}if(s.innerWidth()==P+K&&s.innerHeight()==L+Q){j.trigger("update",[F.captionText]).fadeIn(C.fadeSpeed);h.fadeIn(C.fadeSpeed);x.css("text-indent",0).hide().fadeIn(C.fadeSpeed,function(){l=false});p=I}else{s.animate({width:P,height:L,marginLeft:(-1*(P/2))-(K/2),marginTop:(-1*(L/2))-(Q/2)},C.popupSpeed,"swing",function(){j.trigger("update",[F.captionText]).fadeIn(C.fadeSpeed);h.fadeIn(C.fadeSpeed);x.css("text-indent",0).hide().fadeIn(C.fadeSpeed,function(){l=false});p=I;n.fadeIn(C.fadeSpeed)})}})}if(F.type!="image"){z.trigger("load")}}).bind("poptrox_close",function(){if(l){return true}l=true;s.hide().trigger("poptrox_reset");if(C.onPopupClose){(C.onPopupClose)()}i.fadeOut(C.fadeSpeed,function(){if(C.useBodyOverflow){d.css("overflow","auto")}l=false})}).prependTo("body").hide().trigger("poptrox_reset");y.keydown(function(F){if(s.is(":visible")){switch(F.keyCode){case 37:case 32:if(C.usePopupNav){s.trigger("poptrox_previous");return false}break;case 39:if(C.usePopupNav){s.trigger("poptrox_next");return false}break;case 27:s.trigger("poptrox_close");return false;break}}});w.find(C.selector).each(function(J){var G,L,H=a(this),K=H.find("img"),M=H.data("poptrox");G={src:H.attr("href"),captionText:K.attr("title"),width:H.attr("width"),height:H.attr("height"),type:null,object:null};if(M){var I,F=M.split(",");for(I in F){L=F[I].match(/([0-9]+)x([0-9]+)/);if(L&&L.length==3){G.width=L[1];G.height=L[2]}else{G.type=F[I]}}}if(!G.type){L=G.src.match(/http[s]?:\/\/([a-z0-9\.]+)\/.*/);if(!L||L.length<3){L=[false]}switch(L[1]){case"api.soundcloud.com":G.type="soundcloud";break;case"youtu.be":G.type="youtube";break;case"vimeo.com":G.type="vimeo";break;default:G.type="image";break}}L=G.src.match(/http[s]?:\/\/[a-z0-9\.]+\/(.*)/);switch(G.type){case"ignore":break;case"iframe":G.object=a('<iframe src="" frameborder="0"></iframe>');G.object.bind(B,function(N){N.stopPropagation()}).css("cursor","auto");break;case"ajax":G.object=a('<div class="poptrox-ajax"></div>');G.object.bind(B,function(N){N.stopPropagation()}).css("cursor","auto").css("overflow","auto");break;case"soundcloud":G.object=a('<iframe scrolling="no" frameborder="no" src=""></iframe>');G.src="https://w.soundcloud.com/player/?url="+escape(G.src);G.width="600";G.height="166";break;case"youtube":G.object=a('<iframe src="" frameborder="0" allowfullscreen="1"></iframe>');G.src="http://www.youtube.com/embed/"+L[1];break;case"vimeo":G.object=a('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>');G.src="http://player.vimeo.com/video/"+L[1];break;default:G.object=a('<img src="" alt="" />');if(C.preload){var L=document.createElement("img");L.src=G.src;q.push(L)}break}v.push(G);K.attr("title","");if(G.type!="ignore"){H.attr("href","").css("outline",0).click(function(N){N.preventDefault();N.stopPropagation();s.trigger("poptrox_open",[J])})}});return a(this)}})(jQuery);